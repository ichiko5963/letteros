# LetterOS メルマガシステム設計書

この統合設計書は、letterosメルマガ作成システムの全体像と、AI支援による高品質メルマガ作成フローを定義します。

---

## システム概要

### ビジョン

**「AIと対話しながら、あなたらしい高品質メルマガを毎回確実に作成できるシステム」**

### 主要機能

1. **メルマガルールの自動チェック**
   - テンプレート1〜9から抽出した共通要素に基づく品質保証
   - 不足要素の自動検出とフィードバック

2. **1〜5通シーケンスの構成支援**
   - 商品価格・期間に応じた最適パターンの提案
   - 各通の役割に基づいた構成ガイド

3. **AI対話による経験談の深掘り**
   - 抽象的な記憶を具体的な情景描写に変換
   - 五感・感情・数字を引き出す質問フロー

4. **リアルタイム品質チェック**
   - 執筆中のルール適合度を確認
   - 改善提案と代替案の提示

---

## システムアーキテクチャ

```
┌─────────────────────────────────────────────────┐
│           LetterOS Newsletter System            │
└─────────────────────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        │               │               │
   ┌────▼─────┐  ┌─────▼────┐  ┌──────▼──────┐
   │  Rules   │  │ Sequence │  │AI Assistant │
   │  Engine  │  │ Planner  │  │   Engine    │
   └────┬─────┘  └─────┬────┘  └──────┬──────┘
        │               │               │
        └───────────────┼───────────────┘
                        │
            ┌───────────▼───────────┐
            │   User Interface      │
            │  (対話型ワークフロー)  │
            └───────────────────────┘
```

### コンポーネント

#### 1. Rules Engine
- **役割**: メルマガルールの管理と品質チェック
- **データソース**: `/docs/newsletter-rules.md`
- **機能**:
  - 12カテゴリのルールチェック
  - チェックリスト自動検証
  - スコアリングと評価

#### 2. Sequence Planner
- **役割**: 1〜5通のシーケンス設計支援
- **データソース**: `/docs/newsletter-sequence-patterns.md`
- **機能**:
  - パターン選択支援
  - 各通の役割定義
  - 配信間隔の提案

#### 3. AI Assistant Engine
- **役割**: ユーザーとの対話による情報収集と品質向上
- **データソース**: `/docs/ai-newsletter-assistant-prompt.md`
- **機能**:
  - 経験談の深掘り質問
  - 具体性の引き出し
  - リアルタイムフィードバック

---

## メルマガ作成ワークフロー

### 全体フロー(5つのフェーズ)

```
Phase 1: 準備 → Phase 2: 情報収集 → Phase 3: 構成 → Phase 4: 執筆 → Phase 5: 品質保証
  (30%)         (40%)               (15%)         (5%)         (10%)
```

### Phase 1: 準備(30%)

#### 1.1 プロジェクトとパターンの選択

**AIの質問**:
```
メルマガを作成します。以下を教えてください:

1. プロジェクト名: {プロジェクト名}
2. シーケンス: {1〜5通のどれか}
3. 今回作成: {何通目か}
4. 商品情報:
   - 商品名: {商品名}
   - 価格: {価格}
   - 対象者: {対象者}
5. コアメッセージ: {一貫して伝えたいメッセージ}
```

**システムの処理**:
1. プロジェクトフォルダを特定
2. 既存メルマガの確認
3. シーケンスパターンの読み込み
4. 該当する通の役割を提示

#### 1.2 テンプレート分析とスタイル学習

**AIの質問**:
```
過去のメルマガがありますか?
フォルダを指定してください。

(指定されたら)
✅ {N}件のメルマガを読み込みました

【スタイルの特徴】
- 文体: {特徴}
- 文章の長さ: 平均{X}文字
- 改行パターン: {特徴}
- 挨拶: {パターン}

このスタイルを参考に作成します。
```

**システムの処理**:
1. 指定フォルダからメルマガファイルを検索
2. 直近3〜5件を読み込み
3. スタイル要素を分析:
   - 文体(です・ます調、口語体など)
   - 段落の長さ
   - よく使うフレーズ
   - 改行パターン
4. スタイルプロファイルを作成

### Phase 2: 情報収集(40%)

#### 2.1 経験談の深掘り

**AIの質問フロー**:

```
【STEP 1: 状況設定】
1. いつ、どこで? → {回答}
2. 何をしていた? → {回答}

【STEP 2: 五感の描写】
3. 何が見えた? 聞こえた? 感じた? → {回答}

【STEP 3: 感情】
4. その時の感情は? → {回答}
   ↓(抽象的な場合)
   「{感情}とは、具体的にどんな感じですか?」
   「体のどこで感じましたか?」

【STEP 4: 内面の声】
5. 心の中で何を考えていた? → {回答}
   ↓
   「その思考を、『』で表現してください」
```

**システムの処理**:
1. 回答の抽象度を判定
2. 抽象的な場合は追加質問
3. 800文字に達するまで深掘り継続
4. 経験談データベースに保存

#### 2.2 具体性の収集(数字・固有名詞)

**AIの質問**:
```
【数字を教えてください】
1. 金額: {回答}
2. 人数: {回答}
3. 期間: {回答}
4. その他の数字: {回答}

【固有名詞を教えてください】
1. 場所: {回答}
2. ツール/サービス: {回答}
3. 人物: {回答}
```

**システムの処理**:
1. 数字を抽出してカウント
2. 固有名詞をリスト化
3. 3つ未満の場合は追加質問

#### 2.3 対比構造の準備(該当通の場合)

**AIの質問**:
```
【ビフォーアフター】
1. BEFORE: どんな状態だったか → {回答}
2. 転機: 何がきっかけで変わったか → {回答}
3. AFTER: どう変わったか → {回答}
```

### Phase 3: 構成作成(15%)

#### 3.1 自動構成生成

**システムの処理**:
1. 選択されたパターンを読み込み
2. 収集した情報を各セクションに配置
3. 文字数配分を計算
4. 構成案を生成

**AIの提示**:
```
【構成案】

1. 冒頭の引き込み (300〜500文字)
   内容: {経験談の情景描写}

2. 問題の深掘り (1500〜2000文字)
   内容: {経験談の詳細}
   含む: 五感、感情、内面の声

3. 問題の本質 (600〜800文字)
   内容: {根本原因と仮想敵}

4. 次回予告 (200〜300文字)
   内容: {次回のテーマ}

予想文字数: 約{X}文字

この構成で良いですか?
```

### Phase 4: 執筆サポート(5%)

#### 4.1 セクション別ガイダンス

**AIのガイド**:
```
【{セクション名}を書きましょう】

ポイント:
- {ポイント1}
- {ポイント2}

よくある失敗:
- {失敗例}

良い例:
{参考例}

書けたら見せてください。
```

**システムの処理**:
- セクションごとのガイドライン表示
- 参考例の提示
- 執筆中の部分的フィードバック

### Phase 5: 品質保証(10%)

#### 5.1 全チェックリスト検証

**システムの処理**:

```python
# 疑似コード
def validate_newsletter(content):
    checks = {
        # 構成の原則
        'has_scene_description': check_opening(content),
        'has_story_flow': check_flow(content),
        'min_3000_chars': len(content) >= 3000,

        # 経験談
        'experience_800_chars': count_experience_section(content) >= 800,
        'has_sensory_details': check_five_senses(content),
        'has_emotions': check_emotions(content),
        'has_inner_conflict': check_inner_voice(content),

        # 具体性
        'has_3_numbers': count_numbers(content) >= 3,
        'has_proper_nouns': check_proper_nouns(content),
        'has_clear_time': check_time_clarity(content),

        # メッセージの一貫性
        'core_message_clear': check_core_message(content, core_message),

        # 読者との対話
        'has_questions': count_questions(content) >= 2,
        'represents_reader': check_reader_representation(content),

        # CTA
        'has_clear_cta': check_cta(content),
        'has_ps': check_ps(content),
    }

    return checks
```

**AIのフィードバック**:
```
【品質チェック結果】

✅ 構成の原則: 3/3
✅ 経験談: 4/4
✅ 具体性: 3/3
✅ メッセージの一貫性: 1/1
✅ 読者との対話: 2/2
✅ CTA: 2/2

合格項目: 15/15
品質レベル: ★★★★★ 高品質

【強み】
- 鮮明な情景描写
- 感情の起伏が豊か
- 具体的な数字が効果的

保存しますか?
```

#### 5.2 改善提案(不合格の場合)

**AIのフィードバック**:
```
【品質チェック結果】

合格項目: 10/15
品質レベル: ★★★☆☆ 改善推奨

【改善が必要】

1. 経験談の長さ不足
   現状: 500文字
   目標: 800文字以上
   提案: {セクション名}をもっと詳しく描写しましょう

   追加質問:
   - その時、周りに何が見えましたか?
   - どんな音が聞こえましたか?
   - 体のどこかに感覚はありましたか?

2. 数字が不足
   現状: 1個
   目標: 3個以上
   提案: 以下を追加できますか?
   - 期間(何ヶ月、何年)
   - 金額(投資額、売上など)
   - 人数(関わった人数など)

修正しますか?
```

---

## データフロー

### 入力データ

```json
{
  "project": {
    "name": "プロジェクト名",
    "folder": "/path/to/project"
  },
  "sequence": {
    "pattern": "3通パターン",
    "current": 1,
    "total": 3
  },
  "product": {
    "name": "商品名",
    "price": 300000,
    "target": "対象者"
  },
  "core_message": "コアメッセージ",
  "experience": {
    "when": "時間・場所",
    "what": "行動",
    "senses": {
      "sight": "視覚情報",
      "sound": "聴覚情報",
      "touch": "触覚情報"
    },
    "emotions": ["焦り", "不安"],
    "inner_voice": "心の声"
  },
  "numbers": [
    "3ヶ月",
    "300万円",
    "33名"
  ],
  "proper_nouns": [
    "ららぽーと",
    "Obsidian"
  ]
}
```

### 出力データ

```markdown
---
title: {タイトル}
sequence: {X}通パターンの{Y}通目
project: {プロジェクト名}
core_message: {コアメッセージ}
created_at: {作成日時}
quality_score: {スコア}/15
---

# {タイトル}

## 件名
{件名}

## 本文

{冒頭の引き込み}

---

{問題の深掘り}

---

{問題の本質}

---

{次回予告または行動喚起}

## 追伸
{追伸内容}

---

## メタ情報
- 文字数: {X}文字
- 経験談: {Y}文字
- 数字: {Z}個
- 固有名詞: {N}個
```

---

## 実装仕様

### 必要なファイル

```
/letteros/docs/
├── newsletter-rules.md                  # メルマガルール
├── newsletter-sequence-patterns.md      # 1〜5通のパターン
├── ai-newsletter-assistant-prompt.md    # AIアシスタントプロンプト
├── NEWSLETTER_SYSTEM_DESIGN.md          # このファイル
└── template①〜⑨                         # 参考テンプレート
```

### AIエージェントへの統合方法

#### 方法1: プロンプトに直接埋め込み

```markdown
あなたは高品質メルマガ作成アシスタントです。

以下のドキュメントを参照して、ユーザーをサポートしてください:

【メルマガルール】
{newsletter-rules.mdの内容}

【シーケンスパターン】
{newsletter-sequence-patterns.mdの内容}

【アシスタントガイド】
{ai-newsletter-assistant-prompt.mdの内容}

それでは、ユーザーとの対話を開始してください。
```

#### 方法2: RAGによる動的参照

```python
# 疑似コード
def get_relevant_rules(context):
    """
    現在のフェーズとコンテキストに応じて
    関連するルールとガイドを取得
    """
    if context.phase == 'experience_collection':
        return retrieve_docs('経験談の深掘り')
    elif context.phase == 'quality_check':
        return retrieve_docs('チェックリスト')
    # ...
```

#### 方法3: Obsidian + Cursor統合

```markdown
# letteros/
├── Marketing/
│   ├── B1/
│   │   └── Belief-1.md
│   ├── Mail/
│   │   ├── Mail-1.md
│   │   ├── Mail-2.md
│   │   └── Mail-3.md
│   └── Templates/
│       ├── template①.md
│       └── ...
└── Rules/
    ├── newsletter-rules.md
    ├── newsletter-sequence-patterns.md
    └── ai-newsletter-assistant-prompt.md
```

Cursorで作業時、関連ファイルを自動参照:
- `@newsletter-rules.md`
- `@newsletter-sequence-patterns.md`
- `@ai-newsletter-assistant-prompt.md`

---

## 使用例

### ケース1: 3通パターンの1通目作成

**ユーザー**: 「3通パターンの1通目を作りたい」

**AIのフロー**:

1. **準備フェーズ**
   ```
   プロジェクト名: Contents Engine講座
   シーケンス: 3通パターン
   今回: 1通目
   商品: Contents Engine (298,000円)
   対象者: コンテンツビジネスで売上を作りたい人
   コアメッセージ: 上流設計が全てを変える
   ```

2. **情報収集フェーズ**
   ```
   【経験談1】
   Q: いつ、どこで?
   A: 2年前の秋、自宅の書斎で

   Q: 何をしていた?
   A: 深夜2時まで、過去のメモを見返していた

   Q: 何が見えた?
   A: 画面の光が目を刺し、スクロールしても情報が見つからない

   Q: 感情は?
   A: 焦りと絶望感

   Q: 心の中では?
   A: 「あれだけ時間をかけたのに...」

   【数字】
   - 2年前
   - 深夜2時
   - 300万円の投資
   ```

3. **構成作成**
   ```
   【構成案】
   1. 冒頭(400文字): 深夜2時の書斎の情景
   2. 問題の深掘り(1800文字): 知識が定着しない苦しみ
   3. 問題の本質(700文字): 上流設計の欠如
   4. 次回予告(200文字): 明日は解決策について
   ```

4. **品質チェック**
   ```
   ✅ 15/15項目クリア
   文字数: 3200文字
   品質: ★★★★★
   ```

### ケース2: 不合格からの改善

**初回提出**: 2000文字、数字1個、経験談500文字

**AIのフィードバック**:
```
【改善が必要】

1. 文字数不足 (2000文字 / 目標3000文字)
   → 経験談をもっと詳しく

2. 経験談不足 (500文字 / 目標800文字)
   → 追加質問します

Q: その時、周りに何が見えましたか?
Q: どんな音が聞こえましたか?
Q: 体に感覚はありましたか?

3. 数字不足 (1個 / 目標3個)
   → 期間と金額を追加できますか?
```

**修正後**:
```
✅ 15/15項目クリア
文字数: 3500文字
品質: ★★★★★
```

---

## 今後の拡張

### Phase 6: 分析とフィードバック

- 配信後のエンゲージメント分析
- 開封率・クリック率の追跡
- A/Bテストの実施

### Phase 7: 自動最適化

- 過去の高パフォーマンスメールの分析
- パーソナライゼーション
- 最適な配信時間の提案

### Phase 8: テンプレート進化

- ユーザーの成功パターンを学習
- 業界別テンプレートの生成
- スタイルの自動適応

---

## まとめ

このシステムにより:

✅ **一貫した高品質** - メルマガルールに基づく自動チェック
✅ **効率的な作成** - AIとの対話で経験談を深掘り
✅ **戦略的なシーケンス** - 1〜5通のパターンに基づく構成
✅ **あなたらしさの保持** - スタイル学習による個性の反映
✅ **確実な成果** - チェックリストによる品質保証

**目標**: 毎回3000文字以上、見応えのある高品質メルマガを確実に作成できる。

---

**作成日**: 2026年1月7日
**バージョン**: 1.0.0
